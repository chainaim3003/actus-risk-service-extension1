{
  "info": {
    "_postman_id": "ht-mc-cash-pam-001",
    "name": "HybridTreasury-MultiContract-CashPAM-Mirror-6mo",
    "description": "ACTUS Hybrid Treasury: CASH PAM MIRROR DESIGN\n\nFull portfolio modeled as 6 ACTUS contracts:\n  Contract 1: STK  — 40 BTC position ($2M at $50K)  [ad_btc01 only]\n  Contract 2: PAM  — Cash Reserve $500K fiat        [ad_btc01_cash + lb_tr01]\n  Contract 3: PAM  — T-Bill #1 $500K, matures Mar 31\n  Contract 4: PAM  — T-Bill #2 $500K, matures May 31\n  Contract 5: PAM  — T-Bill #3 $250K, matures Jun 30\n  Contract 6: PAM  — T-Bill #4 $500K, matures Jul 31\n\nKEY INNOVATION: Cash PAM contract has a MIRRORED AllocationDriftModel\nthat uses signalMultiplier=-4.0 to invert and scale the BTC rebalancing\nsignal. When BTC is sold (overweight), cash PAM NP increases by the\nsame USD amount. When BTC is bought (underweight), cash PAM NP decreases.\n\nLiquidityBufferModel (lb_tr01) now correctly runs on the cash contract\nwhere it semantically belongs — checking cash balance vs projected outflows.\n\nMath: signalMultiplier = -(BTC value / Cash NP) = -(2000000 / 500000) = -4.0\n  BTC overweight by 5.37%:\n    BTC STK: signal = 0.0537, payoff = 0.0537 × 40 = 2.15 BTC sold\n    Cash PAM: signal = 0.0537 × (-4.0) = -0.2148\n              payoff = -0.2148 × $500K = -$107.4K (negative = inflow)\n              NP goes from $500K → $607.4K\n\nAPPROXIMATION: signalMultiplier is fixed at initial ratio. As BTC price\nchanges, the actual USD flow won't perfectly match. Acceptable for v1.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Add BTC_USD_SPOT (6-month rally & correction)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addReferenceIndex",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addReferenceIndex"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorID\":\"BTC_SPOT_01\",\"marketObjectCode\":\"BTC_USD_SPOT\",\"base\":1.0,\"data\":[{\"time\":\"2026-03-01T00:00:00\",\"value\":50000},{\"time\":\"2026-03-15T00:00:00\",\"value\":52000},{\"time\":\"2026-03-31T00:00:00\",\"value\":55000},{\"time\":\"2026-04-15T00:00:00\",\"value\":58000},{\"time\":\"2026-04-30T00:00:00\",\"value\":62000},{\"time\":\"2026-05-15T00:00:00\",\"value\":68000},{\"time\":\"2026-05-31T00:00:00\",\"value\":75000},{\"time\":\"2026-06-15T00:00:00\",\"value\":85000},{\"time\":\"2026-06-30T00:00:00\",\"value\":90000},{\"time\":\"2026-07-15T00:00:00\",\"value\":84000},{\"time\":\"2026-07-31T00:00:00\",\"value\":78000},{\"time\":\"2026-08-15T00:00:00\",\"value\":72000},{\"time\":\"2026-08-31T00:00:00\",\"value\":65000}]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('BTC_USD_SPOT added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ BTC_SPOT_01: $50K → $90K peak → $65K cooldown');",
        "});"
      ]}}]
    },
    {
      "name": "2. Add PORTFOLIO_TOTAL_VALUE",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addReferenceIndex",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addReferenceIndex"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorID\":\"PORTFOLIO_NAV_01\",\"marketObjectCode\":\"PORTFOLIO_TOTAL_VALUE\",\"base\":1.0,\"data\":[{\"time\":\"2026-03-01T00:00:00\",\"value\":10000000},{\"time\":\"2026-03-15T00:00:00\",\"value\":10080000},{\"time\":\"2026-03-31T00:00:00\",\"value\":10200000},{\"time\":\"2026-04-15T00:00:00\",\"value\":10320000},{\"time\":\"2026-04-30T00:00:00\",\"value\":10480000},{\"time\":\"2026-05-15T00:00:00\",\"value\":10720000},{\"time\":\"2026-05-31T00:00:00\",\"value\":11000000},{\"time\":\"2026-06-15T00:00:00\",\"value\":11400000},{\"time\":\"2026-06-30T00:00:00\",\"value\":11600000},{\"time\":\"2026-07-15T00:00:00\",\"value\":11360000},{\"time\":\"2026-07-31T00:00:00\",\"value\":11120000},{\"time\":\"2026-08-15T00:00:00\",\"value\":10880000},{\"time\":\"2026-08-31T00:00:00\",\"value\":10600000}]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('PORTFOLIO_TOTAL_VALUE added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ PORTFOLIO_NAV_01: $10M → $11.6M peak → $10.6M');",
        "});"
      ]}}]
    },
    {
      "name": "3. Add PROJECTED_OUTFLOWS (AP + quarterly tax stress)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addReferenceIndex",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addReferenceIndex"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorID\":\"OUTFLOWS_01\",\"marketObjectCode\":\"PROJECTED_OUTFLOWS\",\"base\":1.0,\"data\":[{\"time\":\"2026-03-01T00:00:00\",\"value\":200000},{\"time\":\"2026-03-31T00:00:00\",\"value\":200000},{\"time\":\"2026-04-30T00:00:00\",\"value\":250000},{\"time\":\"2026-05-31T00:00:00\",\"value\":300000},{\"time\":\"2026-06-15T00:00:00\",\"value\":650000},{\"time\":\"2026-06-30T00:00:00\",\"value\":800000},{\"time\":\"2026-07-15T00:00:00\",\"value\":650000},{\"time\":\"2026-07-31T00:00:00\",\"value\":500000},{\"time\":\"2026-08-31T00:00:00\",\"value\":250000}]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('PROJECTED_OUTFLOWS added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ OUTFLOWS_01: Normal $200-300K/mo, June stress $800K');",
        "});"
      ]}}]
    },
    {
      "name": "4. Add TBILL_MATURITY_SCHEDULE",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addReferenceIndex",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addReferenceIndex"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorID\":\"TBILL_MAT_01\",\"marketObjectCode\":\"TBILL_MATURITY_SCHEDULE\",\"base\":1.0,\"data\":[{\"time\":\"2026-03-01T00:00:00\",\"value\":0},{\"time\":\"2026-03-31T00:00:00\",\"value\":500000},{\"time\":\"2026-04-30T00:00:00\",\"value\":0},{\"time\":\"2026-05-31T00:00:00\",\"value\":500000},{\"time\":\"2026-06-30T00:00:00\",\"value\":250000},{\"time\":\"2026-07-31T00:00:00\",\"value\":500000},{\"time\":\"2026-08-31T00:00:00\",\"value\":0}]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('TBILL_MATURITY_SCHEDULE added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ TBILL_MAT_01: Reference index for LiquidityBufferModel');",
        "});"
      ]}}]
    },
    {
      "name": "5. Add AllocationDriftModel ad_btc01 (BTC — normal signal)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addAllocationDriftModel",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addAllocationDriftModel"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorId\":\"ad_btc01\",\"spotPriceMOC\":\"BTC_USD_SPOT\",\"portfolioTotalValueMOC\":\"PORTFOLIO_TOTAL_VALUE\",\"targetAllocation\":0.20,\"maxAllocation\":0.25,\"minAllocation\":0.15,\"positionQuantity\":0.0,\"initialNotionalPrincipal\":0.0,\"signalMultiplier\":1.0,\"useFixedQuantity\":false,\"monitoringEventTimes\":[\"2026-03-31T00:00:00\",\"2026-04-30T00:00:00\",\"2026-05-31T00:00:00\",\"2026-06-30T00:00:00\",\"2026-07-31T00:00:00\",\"2026-08-31T00:00:00\"]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('AllocationDriftModel ad_btc01 added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ ad_btc01: BTC allocation drift (STK mode, multiplier=1.0)');",
        "    console.log('   target=20%, band=[15%, 25%], 6 monthly checkpoints');",
        "});"
      ]}}]
    },
    {
      "name": "6. Add AllocationDriftModel ad_btc01_cash (Cash MIRROR — inverted signal)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addAllocationDriftModel",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addAllocationDriftModel"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorId\":\"ad_btc01_cash\",\"spotPriceMOC\":\"BTC_USD_SPOT\",\"portfolioTotalValueMOC\":\"PORTFOLIO_TOTAL_VALUE\",\"targetAllocation\":0.20,\"maxAllocation\":0.25,\"minAllocation\":0.15,\"positionQuantity\":40.0,\"initialNotionalPrincipal\":500000.0,\"signalMultiplier\":-4.0,\"useFixedQuantity\":true,\"monitoringEventTimes\":[\"2026-03-31T00:00:00\",\"2026-04-30T00:00:00\",\"2026-05-31T00:00:00\",\"2026-06-30T00:00:00\",\"2026-07-31T00:00:00\",\"2026-08-31T00:00:00\"]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('AllocationDriftModel ad_btc01_cash added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ ad_btc01_cash: Cash mirror (FIXED mode, multiplier=-4.0)');",
        "    console.log('   Same allocation logic, inverted signal for cash contract');",
        "    console.log('   positionQuantity=40 (BTC units), useFixedQuantity=true');",
        "    console.log('   Ratio: -($2M BTC value / $500K cash NP) = -4.0');",
        "});"
      ]}}]
    },
    {
      "name": "7. Add LiquidityBufferModel lb_tr01 (on Cash PAM)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addLiquidityBufferModel",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addLiquidityBufferModel"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"riskFactorId\":\"lb_tr01\",\"projectedOutflowsMOC\":\"PROJECTED_OUTFLOWS\",\"tbillMaturityScheduleMOC\":\"TBILL_MATURITY_SCHEDULE\",\"minBufferUSD\":3000000,\"targetBufferUSD\":3500000,\"monitoringEventTimes\":[\"2026-03-31T00:00:00\",\"2026-04-30T00:00:00\",\"2026-05-31T00:00:00\",\"2026-06-30T00:00:00\",\"2026-07-31T00:00:00\",\"2026-08-31T00:00:00\"]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('LiquidityBufferModel lb_tr01 added', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ lb_tr01: Now on Cash PAM (not BTC STK!)');",
        "    console.log('   minBuffer=$3M, targetBuffer=$3.5M');",
        "    console.log('   Reads cashBalance from Cash PAM notionalPrincipal');",
        "});"
      ]}}]
    },
    {
      "name": "8. Add Scenario (4 indexes + 2 allocation models + 1 liquidity model)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8082/addScenario",
          "protocol": "http",
          "host": ["localhost:8082"],
          "path": ["addScenario"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"scenarioID\":\"ht_mc_cash_pam_scn01\",\"riskFactorDescriptors\":[{\"riskFactorID\":\"BTC_SPOT_01\",\"riskFactorType\":\"ReferenceIndex\"},{\"riskFactorID\":\"PORTFOLIO_NAV_01\",\"riskFactorType\":\"ReferenceIndex\"},{\"riskFactorID\":\"OUTFLOWS_01\",\"riskFactorType\":\"ReferenceIndex\"},{\"riskFactorID\":\"TBILL_MAT_01\",\"riskFactorType\":\"ReferenceIndex\"},{\"riskFactorID\":\"ad_btc01\",\"riskFactorType\":\"AllocationDriftModel\"},{\"riskFactorID\":\"ad_btc01_cash\",\"riskFactorType\":\"AllocationDriftModel\"},{\"riskFactorID\":\"lb_tr01\",\"riskFactorType\":\"LiquidityBufferModel\"}]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('Scenario created', function(){",
        "    pm.response.to.have.status(200);",
        "    console.log('✅ ht_mc_cash_pam_scn01: 4 indexes + 3 behavioral models');",
        "    console.log('   ad_btc01 → BTC STK, ad_btc01_cash + lb_tr01 → Cash PAM');",
        "});"
      ]}}]
    },
    {
      "name": "9. Run 6-Contract Portfolio Simulation (BTC + Cash + 4 T-Bills)",
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "url": {
          "raw": "http://localhost:8083/rf2/scenarioSimulation",
          "protocol": "http",
          "host": ["localhost:8083"],
          "path": ["rf2", "scenarioSimulation"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\"contracts\":[{\"calendar\":\"NC\",\"businessDayConvention\":\"SCF\",\"contractType\":\"STK\",\"statusDate\":\"2026-02-28T00:00:00\",\"contractRole\":\"RPA\",\"contractID\":\"BTC-Position-40\",\"cycleAnchorDateOfDividend\":\"2026-03-31T00:00:00\",\"cycleOfDividend\":\"P1ML0\",\"currency\":\"USD\",\"contractDealDate\":\"2026-02-28T00:00:00\",\"purchaseDate\":\"2026-03-01T00:00:00\",\"priceAtPurchaseDate\":50000,\"marketValueObserved\":50000,\"quantity\":40,\"treasuryModels\":[\"ad_btc01\"]},{\"calendar\":\"NC\",\"businessDayConvention\":\"SCF\",\"contractType\":\"PAM\",\"statusDate\":\"2026-02-28T00:00:00\",\"contractRole\":\"RPA\",\"contractID\":\"CASH-RESERVE-500K\",\"dayCountConvention\":\"30E360\",\"currency\":\"USD\",\"contractDealDate\":\"2026-02-28T00:00:00\",\"initialExchangeDate\":\"2026-03-01T00:00:00\",\"maturityDate\":\"2026-08-31T00:00:00\",\"notionalPrincipal\":500000,\"nominalInterestRate\":0.0,\"premiumDiscountAtIED\":0,\"treasuryModels\":[\"ad_btc01_cash\",\"lb_tr01\"]},{\"calendar\":\"NC\",\"businessDayConvention\":\"SCF\",\"contractType\":\"PAM\",\"statusDate\":\"2026-02-28T00:00:00\",\"contractRole\":\"RPA\",\"contractID\":\"TBILL-3mo-500K-Mar\",\"dayCountConvention\":\"30E360\",\"currency\":\"USD\",\"contractDealDate\":\"2026-01-01T00:00:00\",\"initialExchangeDate\":\"2026-01-01T00:00:00\",\"maturityDate\":\"2026-03-31T00:00:00\",\"notionalPrincipal\":500000,\"nominalInterestRate\":0.0,\"premiumDiscountAtIED\":0},{\"calendar\":\"NC\",\"businessDayConvention\":\"SCF\",\"contractType\":\"PAM\",\"statusDate\":\"2026-02-28T00:00:00\",\"contractRole\":\"RPA\",\"contractID\":\"TBILL-5mo-500K-May\",\"dayCountConvention\":\"30E360\",\"currency\":\"USD\",\"contractDealDate\":\"2026-01-01T00:00:00\",\"initialExchangeDate\":\"2026-01-01T00:00:00\",\"maturityDate\":\"2026-05-31T00:00:00\",\"notionalPrincipal\":500000,\"nominalInterestRate\":0.0,\"premiumDiscountAtIED\":0},{\"calendar\":\"NC\",\"businessDayConvention\":\"SCF\",\"contractType\":\"PAM\",\"statusDate\":\"2026-02-28T00:00:00\",\"contractRole\":\"RPA\",\"contractID\":\"TBILL-4mo-250K-Jun\",\"dayCountConvention\":\"30E360\",\"currency\":\"USD\",\"contractDealDate\":\"2026-03-01T00:00:00\",\"initialExchangeDate\":\"2026-03-01T00:00:00\",\"maturityDate\":\"2026-06-30T00:00:00\",\"notionalPrincipal\":250000,\"nominalInterestRate\":0.0,\"premiumDiscountAtIED\":0},{\"calendar\":\"NC\",\"businessDayConvention\":\"SCF\",\"contractType\":\"PAM\",\"statusDate\":\"2026-02-28T00:00:00\",\"contractRole\":\"RPA\",\"contractID\":\"TBILL-5mo-500K-Jul\",\"dayCountConvention\":\"30E360\",\"currency\":\"USD\",\"contractDealDate\":\"2026-03-01T00:00:00\",\"initialExchangeDate\":\"2026-03-01T00:00:00\",\"maturityDate\":\"2026-07-31T00:00:00\",\"notionalPrincipal\":500000,\"nominalInterestRate\":0.0,\"premiumDiscountAtIED\":0}],\"scenarioDescriptor\":{\"scenarioID\":\"ht_mc_cash_pam_scn01\",\"scenarioType\":\"scenario\"},\"simulateTo\":\"2026-08-31T00:00:00\",\"monitoringTimes\":[]}"
        }
      },
      "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": [
        "pm.test('6-contract portfolio simulation', function(){",
        "    pm.response.to.have.status(200);",
        "    var data = pm.response.json();",
        "    pm.expect(data.length).to.eql(6);",
        "    console.log('═'.repeat(80));",
        "    console.log('HYBRID TREASURY: CASH PAM MIRROR — 6 CONTRACT SIMULATION');",
        "    console.log('═'.repeat(80));",
        "    console.log('');",
        "    console.log('PORTFOLIO (6 ACTUS contracts):');",
        "    console.log('  1. STK  BTC-Position-40      40 BTC ($2M)    [ad_btc01]');",
        "    console.log('  2. PAM  CASH-RESERVE-500K    $500K fiat      [ad_btc01_cash, lb_tr01]');",
        "    console.log('  3. PAM  TBILL-3mo-500K-Mar   $500K           matures Mar 31');",
        "    console.log('  4. PAM  TBILL-5mo-500K-May   $500K           matures May 31');",
        "    console.log('  5. PAM  TBILL-4mo-250K-Jun   $250K           matures Jun 30');",
        "    console.log('  6. PAM  TBILL-5mo-500K-Jul   $500K           matures Jul 31');",
        "    console.log('');",
        "    console.log('═'.repeat(80));",
        "    data.forEach(function(contractResult, idx){",
        "        var events = contractResult.events;",
        "        var counts = {};",
        "        events.forEach(function(e){counts[e.type]=(counts[e.type]||0)+1;});",
        "        console.log('');",
        "        console.log('── CONTRACT ' + (idx+1) + ': ' + contractResult.contractId + ' ──');",
        "        console.log('   Status: ' + contractResult.status);",
        "        console.log('   Total events: ' + events.length);",
        "        var typeStr = Object.keys(counts).map(function(k){return k+':'+counts[k];}).join(', ');",
        "        console.log('   Event types: ' + typeStr);",
        "        console.log('');",
        "        events.forEach(function(e){",
        "            var line = '   '+e.time.substring(0,10)+' '+e.type;",
        "            line += '  payoff='+e.payoff.toFixed(2);",
        "            line += '  notional='+e.nominalValue.toFixed(2);",
        "            if (e.type === 'PP' && contractResult.contractId === 'CASH-RESERVE-500K') {",
        "                line += '  ← CASH ' + (e.payoff < 0 ? 'INFLOW (BTC sold)' : 'OUTFLOW (BTC bought)');",
        "            }",
        "            console.log(line);",
        "        });",
        "    });",
        "    console.log('');",
        "    console.log('═'.repeat(80));",
        "    console.log('CASH MIRROR VERIFICATION:');",
        "    var btcEvents = data[0].events.filter(function(e){return e.type==='PP';});",
        "    var cashEvents = data[1].events.filter(function(e){return e.type==='PP';});",
        "    console.log('  BTC PP events: ' + btcEvents.length);",
        "    console.log('  Cash PP events: ' + cashEvents.length);",
        "    btcEvents.forEach(function(e,i){",
        "        var cashE = cashEvents[i];",
        "        if(cashE) {",
        "            console.log('  ' + e.time.substring(0,10) + ': BTC payoff=' + e.payoff.toFixed(4) + '  Cash payoff=' + cashE.payoff.toFixed(2));",
        "        }",
        "    });",
        "    console.log('');",
        "    var lastCashEvent = data[1].events[data[1].events.length-1];",
        "    console.log('  Final cash balance (NP): $' + lastCashEvent.nominalValue.toFixed(2));",
        "    console.log('═'.repeat(80));",
        "});",
        "pm.test('All 6 contracts succeeded', function(){",
        "    var data = pm.response.json();",
        "    data.forEach(function(r){ pm.expect(r.status).to.eql('Success'); });",
        "});"
      ]}}]
    }
  ]
}
